---
original: eb34980558718167195f3469e93c63a7450ecfd87a909a640979a3957067efa4
---

NIP-50
======

検索機能
--------

`draft` `optional`

## 概要

多くのNostrのユースケースでは、タグやIDによる構造化されたクエリに加えて、何らかの一般的な検索機能が必要です。
検索アルゴリズムの詳細はイベントの種類によって異なりますが、このNIPではそのようなクエリを実行するための
一般的で拡張可能なフレームワークのみを説明します。

## `search` フィルターフィールド

クライアントからの `REQ` メッセージに新しい `search` フィールドが導入されます：
```json
{
  ...
  "search": <string>
}
```
`search` フィールドは、人間が読める形式でクエリを記述する文字列です。例えば、"best nostr apps"のようなものです。
リレーはできる限り最善の方法でクエリを解釈し、それに一致するイベントを返すべきです（SHOULD）。
リレーは `content` イベントフィールドに対してマッチングを実行すべきで（SHOULD）、特定の種類のコンテキストで
意味がある場合は他のフィールドに対してもマッチングを実行してもよいです（MAY）。

結果は、通常の `.created_at` ではなく、検索結果の品質（実装によって定義される）に基づいて降順で返されるべきです（SHOULD）。
`limit` フィルターは、マッチングスコアでソートした後に適用されるべきです（SHOULD）。
クエリ文字列には `key:value` ペア（コロンで区切られた2つの単語）を含めることができます。これらは拡張機能であり、
リレーはサポートしていない拡張機能を無視すべきです（SHOULD）。

クライアントは複数の検索フィルターを指定できます。例えば、`["REQ", "", { "search": "orange" }, { "kinds": [1, 2], "search": "purple" }]` のようにです。
クライアントは `kinds`、`ids`、その他のフィルターフィールドを含めて、検索結果を特定のイベントの種類に制限できます。

クライアントはsupported_nipsフィールドを使用して、リレーが `search` フィルターをサポートしているかどうかを確認すべきです（SHOULD）。
クライアントは、このNIPをサポートしていないリレーからの余分な応答をフィルタリングする準備ができていれば、
任意のリレーに `search` フィルタークエリを送信してもよいです（MAY）。

クライアントは、リレー間の潜在的な実装の違いを補うために、このNIPをサポートする複数のリレーにクエリを送信すべきです（SHOULD）。

クライアントは、リレーが返したイベントがクライアントのユースケースに適した方法で指定されたクエリに一致することを
確認してもよく（MAY）、精度の低いリレーへのクエリを停止してもよいです（MAY）。

リレーは、何らかの形式のスパムフィルタリングをサポートしている場合、デフォルトで検索結果からスパムを除外すべきです（SHOULD）。

## 拡張機能

リレーは以下の拡張機能をサポートしてもよいです（MAY）：
- `include:spam` - デフォルトで有効になっていた場合、スパムフィルタリングをオフにする
- `domain:<domain>` - 有効なnip05ドメインが指定されたドメインと一致するユーザーのイベントのみを含める
- `language:<2文字のISO 639-1言語コード>` - 指定された言語のイベントのみを含める
- `sentiment:<negative/neutral/positive>` - 特定の感情のイベントのみを含める
- `nsfw:<true/false>` - NSFWイベントを含めるか除外する（デフォルト：true）