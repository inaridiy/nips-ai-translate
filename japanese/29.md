---
original: 08f4cd741ad84a9cd78f61d398b3cd44fc79044ec37c3bab863f34d0719366b0
---

NIP-29
======

リレーベースのグループ
------------------

`draft` `optional`

この NIP は、限定されたユーザーセットのみが書き込み可能なグループの標準を定義します。これらは外部ユーザーによる読み取りが可能な公開グループか、そうでないかのいずれかです。

グループは、_id_ として機能する任意の長さのランダムな文字列によって識別されます。

グループを作成する特別な方法はありません。実際に起こるのは、リレー（多くの場合ユーザーに要求されて）が特定の id の周りにルールを作成し、これらの id が実際のグループとして機能できるようにすることです。その後、そのグループに送信されたメッセージはこれらのルールの対象となります。

通常、グループは最初は1つの特定のリレーに属しますが、コミュニティはグループを他のリレーに移動したり、グループをフォークして異なる形で存在させる（同じ _id_ を使用しながら）ことを選択できます。

## リレー生成イベント

リレーは、グループのメタデータとグループ管理者を記述するイベントを生成することが想定されています。これらは、リレーの鍵ペアによって直接署名された、グループ _id_ を `d` タグとするパラメータ化された置換可能イベントです。

## グループ識別子

グループは `<host>'<group-id>` 形式の文字列で識別される場合があります。例えば、_id_ が `abcdef` で、リレー `wss://groups.nostr.com` でホストされているグループは、`groups.nostr.com'abcdef` という文字列で識別されます。

## `h` タグ

ユーザーがグループに送信するイベント（チャットメッセージ、テキストノート、モデレーションイベントなど）には、グループ _id_ を値とする `h` タグが必要です。

## タイムライン参照

コンテキスト外で使用されないように、これらのグループに送信されるイベントには、同じリレーから見た以前のイベントへの参照を `previous` タグに含めることができます。どの以前のイベントを選択するかはクライアントに任されています。参照は、ユーザーがリレーで最後に見た50イベントのうち、自分自身のイベントを除く任意のイベントの最初の8文字（4バイト）を使用して行われます。参照の数は任意（ゼロを含む）ですが、クライアントは少なくとも3つ含めることが推奨され、リレーはこれを強制することが推奨されます。

これは、あるグループのフォークを持つ外部リレーにメッセージがコンテキスト外でブロードキャストされるのを防ぐためのハックです。リレーは、自身のデータベースに存在しないイベントへのタイムライン参照を含むイベントを拒否することが期待されます。クライアントもこれらをチェックして、リレーがこれらに関して正直であることを確認する必要があります。

## 遅延公開

リレーは、グループが別のリレーからフォークまたは移動されたものを受け入れる場合を除き、遅延公開（数日前や数時間前のタイムスタンプで現在公開されるメッセージ）を防ぐべきです。

## イベント定義

- *テキストルートノート* (`kind:11`)

これは、グループに送信される「マイクロブログ」ルートテキストノートの基本単位です。

```js
  "kind": 11,
  "content": "hello my friends lovers of pizza",
  "tags": [
    ["h", "<group-id>"],
    ["previous", "<event-id-first-chars>", "<event-id-first-chars>", ...]
  ]
  ...
```

- *スレッド化テキスト返信* (`kind:12`)

これは、グループに送信される「マイクロブログ」返信ノートの基本単位です。他のノートへの返信の場合（`kind:11` または `kind:12` への返信）に使用しなければならない点を除いて、`kind:11` と同じです。`kind:12` イベントは NIP-10 マーカーを使用し、空のリレー URL を残す必要があります（SHOULD）：

* `["e", "<kind-11-root-id>", "", "root"]`
* `["e", "<kind-12-event-id>", "", "reply"]`

- *チャットメッセージ* (`kind:9`)

これは、グループに送信される _チャットメッセージ_ の基本単位です。

```js
  "kind": 9,
  "content": "hello my friends lovers of pizza",
  "tags": [
    ["h", "<group-id>"],
    ["previous", "<event-id-first-chars>", "<event-id-first-chars>", ...]
  ]
  ...
```

- *チャットメッセージスレッド返信* (`kind:10`)

`kind:12` と同様に、これはグループに送信されるチャットメッセージの基本単位です。これは、デフォルトで非表示になる可能性のあるチャット内スレッド用です。すべてのチャット内返信が `kind:10` を使用する必要はなく、通常のチャットの流れの一部ではない隠れたスレッドを作成する意図がある場合にのみ使用します（ただし、クライアントはこれらをデフォルトで表示することも自由です）。

`kind:10` は `kind:12` と同様に NIP-10 マーカーを使用する必要があります（SHOULD）。

- *参加リクエスト* (`kind:9021`)

任意のユーザーがグループに自動的または手動で追加されるために、これらのイベントの1つをリレーに送信できます。グループが `open` の場合、リレーは自動的にこのユーザーを追加する `kind:9000` を発行します。それ以外の場合、グループ管理者はこれらのリクエストを照会して対応することを選択できます。

```js
{
  "kind": 9021,
  "content": "optional reason",
  "tags": [
    ["h", "<group-id>"]
  ]
}
```

- *モデレーションイベント* (`kinds:9000-9020`) (オプション)

クライアントはモデレーションアクションを実行するために、これらのイベントをリレーに送信できます。リレーは、イベントを送信する pubkey が指定されたアクションを実行する能力があるかどうかをチェックする必要があります。リレーはアクションを実行した後、イベントを破棄するか、モデレーションログとして保持することができます。

```js
{
  "kind": 90xx,
  "content": "optional reason",
  "tags": [
    ["h", "<group-id>"],
    ["previous", ...]
  ]
}
```

各モデレーションアクションは異なる kind を使用し、異なる引数が必要です。これらはタグとして与えられます。以下の表で定義されています：

| kind | 名前                | タグ                                      |
| ---  | ---                 | ---                                       |
| 9000 | `add-user`          | `p` (pubkey hex)                          |
| 9001 | `remove-user`       | `p` (pubkey hex)                          |
| 9002 | `edit-metadata`     | `name`, `about`, `picture` (string)       |
| 9003 | `add-permission`    | `p` (pubkey), `permission` (name)         |
| 9004 | `remove-permission` | `p` (pubkey), `permission` (name)         |
| 9005 | `delete-event`      | `e` (id hex)                              |
| 9006 | `edit-group-status` | `public` または `private`, `open` または `closed` |
| 9007 | `create-group`      |                                           |

- *グループメタデータ* (`kind:39000`) (オプション)

このイベントはグループのメタデータを定義します - 基本的にクライアントがどのように表示すべきかを定義します。これは、見つかったリレーによって生成され、署名される必要があります。リレーは他の誰かによって署名されたこれらのイベントを受け入れるべきではありません。

グループがフォークされ、複数のリレーでホストされている場合、それぞれ異なるリレーにこのイベントの複数のバージョンが存在することになります。

```js
{
  "kind": 39000,
  "content": "",
  "tags": [
    ["d", "<group-id>"],
    ["name", "Pizza Lovers"],
    ["picture", "https://pizza.com/pizza.png"],
    ["about", "a group for people who love pizza"],
    ["public"], // または ["private"]
    ["open"] // または ["closed"]
  ]
  ...
}
```

`name`、`picture`、`about` は表示目的のグループの基本的なメタデータです。`public` は誰でもグループを _読める_ ことを示し、`private` は AUTH されたユーザーのみが読めることを示します。`open` は誰でも参加をリクエストでき、リクエストが自動的に承認されることを示し、`closed` はメンバーが事前承認される必要があるか、参加リクエストが手動で処理されることを示します。

- *グループ管理者* (`kind:39001`) (オプション)

グループメタデータと同様に、このイベントはグループをホストするリレーによって生成されることが想定されています。

各管理者には表示目的でのみ使用されるラベルが付けられ、その後に持っている権限のリストが列挙されます。これらの権限はクライアントの UI 構築に情報を提供しますが、最終的にはリレーによって評価されて有効になります。

この NIP で定義されている現在の機能リストは以下の通りです：

- `add-user`
- `edit-metadata`
- `delete-event`
- `remove-user`
- `add-permission`
- `remove-permission`
- `edit-group-status`

```js
{
  "kind": 39001,
  "content": "list of admins for the pizza lovers group",
  "tags": [
    ["d", "<group-id>"],
    ["p", "<pubkey1-as-hex>", "ceo", "add-user", "edit-metadata", "delete-event", "remove-user"],
    ["p", "<pubkey2-as-hex>", "secretary", "add-user", "delete-event"]
  ]
  ...
}
```

- *グループメンバー* (`kind:39002`) (オプション)

*グループ管理者* と同様に、このイベントはグループをホストするリレーによって生成されることが想定されています。

これはグループのメンバーである pubkey の NIP-51 に似たリストです。リレーはこの情報を公開しないか、どの pubkey がこれをフェッチできるかを制限することを選択できます。

```json
{
  "kind": 39002,
  "content": "list of members for the pizza lovers group",
  "tags": [
    ["d", "<group-id>"],
    ["p", "<admin1>"],
    ["p", "<member-pubkey1>"],
    ["p", "<member-pubkey2>"],
  ]
}
```

## ユーザーが所属するグループのリストの保存

ユーザーが所属していることを記憶したいグループのリストをクライアントが保存できるようにする kind `10009` の定義が [NIP-51](51.md) に含まれています。