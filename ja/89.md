---
original: adf73efd532a625742e1e3c6051def49760b27bb9b584fae76b633f327e53428
---

NIP-89
======

推奨アプリケーションハンドラー
--------------------------------

`draft` `optional`

このNIPは`kind:31989`と`kind:31990`について説明します：未知のイベント種類を処理できるアプリケーションを発見する方法です。

## 根拠

Nostrの発見可能性と透明なイベント相互作用は、最も興味深く斬新なメカニズムの1つです。
このNIPは、特定の種類のイベントを処理するアプリケーションをクライアントが発見するための簡単な方法を提供し、クライアント間および種類間の円滑な相互作用を確保します。

### 関係者

このワークフローには3つの関係者がいます：

* 特定のイベント種類を処理するアプリケーション（アプリケーションは必ずしも別個のエンティティである必要はなく、ユーザーAと同じpubkeyでも構いません）
    * `kind:31990`を公開し、アプリへのリダイレクト方法を詳細に説明します
* 特定のイベント種類を処理するアプリを推奨するユーザーA
    * `kind:31989`を公開します
* 特定のイベント種類を処理するアプリの推奨を求めるユーザーB
    * `kind:31989`を照会し、結果に基づいて`kind:31990`を照会します

## イベント

### 推奨イベント
```json
{
  "kind": 31989,
  "pubkey": <recommender-user-pubkey>,
  "tags": [
    ["d", <supported-event-kind>],
    ["a", "31990:app1-pubkey:<d-identifier>", "wss://relay1", "ios"],
    ["a", "31990:app2-pubkey:<d-identifier>", "wss://relay2", "web"]
  ]
}
```

`kind:31989`の`d`タグは、このイベントが推奨しているサポートされているイベント種類です。

同じ`kind:31989`に複数の`a`タグが表示される場合があります。

タグの2番目の値はリレーヒントであるべきです（SHOULD）。
タグの3番目の値は、この推奨が適用される可能性のあるプラットフォームであるべきです（SHOULD）。

## ハンドラー情報
```json
{
  "kind": 31990,
  "pubkey": "<application-pubkey>",
  "content": "<optional-kind:0-style-metadata>",
  "tags": [
    ["d", <random-id>],
    ["k", <supported-event-kind>],
    ["web", "https://..../a/<bech32>", "nevent"],
    ["web", "https://..../p/<bech32>", "nprofile"],
    ["web", "https://..../e/<bech32>"],
    ["ios", ".../<bech32>"]
  ]
}
```

* `content`はNIP-01で説明されている`metadata`のようなオプションの文字列化されたJSONオブジェクトです。このコンテンツは、`kind:31990`を作成するpubkeyがアプリケーションでない場合に役立ちます。`content`が空の場合、アプリケーション情報（名前、画像、ウェブ、LUD16など）を表示するためにpubkeyの`kind:0`を使用する必要があります。
* `k`タグの値は、この`kind:31990`でサポートされているイベント種類です。
`k`タグを使用する理由（`d`タグの種類を持つ代わりに）は以下の通りです：
    * アプリケーションが複数のイベント種類をサポートし、それらのハンドラーURLが同じ場合、同じイベントに複数の`k`タグが存在する可能性があります。
    * 同じpubkeyが、同じイベント種類を処理する異なるアプリを持つ複数のイベントを持つことができます。
* URLの`bech32`は、アプリケーションによってロードされるべきNIP-19エンコードされたエンティティでクライアントによって置き換えられなければなりません（MUST）。

アプリは、NIP-19の命名法に従って、配列の2番目の値として複数のタグを登録する場合があります。

配列の2番目の値がないタグは、異なるタグで処理されていないNIP-19エンティティの汎用ハンドラーとみなされるべきです（SHOULD）。

# クライアントタグ
イベントを公開する際、クライアントはノートを公開したクライアントを識別する`client`タグを含めることができます（MAY）。このタグは、`name`、ハンドラーイベントを識別する`address`、およびハンドラーイベントを見つけるためのリレー`hint`のタプルです。これはユーザーのプライバシーに影響を与える可能性があるため、クライアントはユーザーがこのタグの使用をオプトアウトできるようにするべきです（SHOULD）。

```json
{
  "kind": 1,
  "tags": [
    ["client", "My Client", "31990:app1-pubkey:<d-identifier>", "wss://relay1"]
  ]
  ...
}
```

## ユーザーフロー
`kind:1`中心ではないNostrアプリを使用するユーザーAは、特定の種類ハンドラーアプリケーションを発表/推奨することを選択できます。

ユーザーBが未知のイベント種類を見たとき（例：ソーシャルメディア中心のNostrクライアントで）、クライアントはユーザーBが未知の種類のイベントと対話できるようにします（例：タップする）。

クライアントは、ユーザーとユーザーのフォローのハンドラーを照会する場合があります。

## 例

### ユーザーAが`kind:31337`ハンドラーを推奨する
ユーザーAは、`kind:31337`中心のクライアント（トラック）であるZapstrのユーザーかもしれません。Zapstrを使用して、ユーザーAはZapstrを`kind:31337`ハンドラーとして推奨するイベントを公開します。

```json
{
  "kind": 31989,
  "tags": [
    ["d", "31337"],
    ["a", "31990:1743058db7078661b94aaf4286429d97ee5257d14a86d6bfa54cb0482b876fb0:abcd", <relay-url>, "web"]
  ],
  ...
}
```

### ユーザーBが`kind:31337`ハンドラーと対話する
ユーザーBは、タイムラインで`kind:31337`イベントを参照するイベント（例：`kind:31337`をタグ付けした`kind:1`）を見るかもしれません。

ユーザーBのクライアントは、`kind:31337`の処理方法を知らないため、NIP-31で説明されている`alt`タグを使用してイベントを表示する場合があります。ユーザーがイベントをクリックすると、アプリケーションはこの`kind`のハンドラーを照会します：

```json
["REQ", <id>, { "kinds": [31989], "#d": ["31337"], "authors": [<user>, <users-contact-list>] }]
```

ユーザーAをフォローしているユーザーBは、その`kind:31989`イベントを見て、アプリとハンドラー情報のために`a`タグ付きイベントを取得します。

ユーザーBのクライアントは、アプリケーションの`kind:31990`を見て、ユーザーを関連するURLにリダイレクトする情報（URLで希望のエンティティが置き換えられている）を含んでいることを確認します。

### `kind:31989`をバイパスする代替クエリ
あるいは、ユーザーはイベント種類に対して直接`kind:31990`を照会することを選択できます。クライアントはこれを慎重に行い、スパム防止メカニズムを使用するか、高品質の制限付きリレーを照会して、ユーザーを悪意のあるハンドラーに誘導することを避けるべきです（SHOULD）。

```json
["REQ", <id>, { "kinds": [31990], "#k": [<desired-event-kind>], "authors": [...] }]
```