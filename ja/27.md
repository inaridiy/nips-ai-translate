---
original: e07c3d6163ad0f2c899b4abc386229c1dd2d30c38b83cc28228a43fee7f3cbe6
---

NIP-27
======

テキストノート参照
------------------

`draft` `optional`

このドキュメントは、`.content`に読み取り可能なテキストを含むイベント（種類1や30023など）の`.content`内にある他のイベントやプロファイルのインライン参照をクライアントが扱う方法を標準化します。

イベントを作成する際、クライアントは[NIP-21](21.md)コードを使用して、`.content`の途中に他のプロファイルや他のイベントへの言及を含めるべきです。例えば、`nostr:nprofile1qqsw3dy8cpu...6x2argwghx6egsqstvg`のようなものです。

各参照に対して[NIP-10](10.md)スタイルのタグ（`["e", <hex-id>, <relay-url>, <marker>]`）を含めるのはオプションです。クライアントは、言及されたプロファイルに通知したい場合や、参照されたイベントが返信として認識されるようにしたい場合に、これを行うべきです。

`.content`にこのような`nostr:...`の言及を含むイベントを受信したリーダークライアントは、処理の過程で任意のコンテキスト拡張（例えば、プロファイルへのリンクや言及されたイベントの内容のプレビューの表示など）を行うことができます。このような言及をリンクに変換する場合、内部リンク、[NIP-21](21.md)リンク、またはこれらの参照を処理するWebクライアントへの直接リンクにすることができます。

---

## プロファイル言及プロセスの例

ボブが、`@`文字を入力すると検索と自動補完機能が起動するクライアントでノートを書いているとします。

ボブが`"hello @mat"`と入力すると、クライアントは[mattnのプロファイル](https://njump.me/npub1937vv2nf06360qn9y8el6d8sevnndy7tuh5nzre4gj05xc32tnwqauhaj6)で自動補完を促し、写真と名前を表示します。

ボブが「エンター」を押すと、入力したノートが`"hello @mattn"`と表示され、`@mattn`がハイライトされ、言及であることを示します。しかし、内部的にはイベントは次のようになっています：

```json
{
  "content": "hello nostr:nprofile1qqszclxx9f5haga8sfjjrulaxncvkfekj097t6f3pu65f86rvg49ehqj6f9dh",
  "created_at": 1679790774,
  "id": "f39e9b451a73d62abc5016cffdd294b1a904e2f34536a208874fe5e22bbd47cf",
  "kind": 1,
  "pubkey": "79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798",
  "sig": "f8c8bab1b90cc3d2ae1ad999e6af8af449ad8bb4edf64807386493163e29162b5852a796a8f474d6b1001cddbaac0de4392838574f5366f03cc94cf5dfb43f4d",
  "tags": [
    [
      "p",
      "2c7cc62a697ea3a7826521f3fd34f0cb273693cbe5e9310f35449f43622a5cdc"
    ]
  ]
}
```

（あるいは、言及は`nostr:npub1...`URLであった可能性もあります。）

ボブがこのイベントを公開し、キャロルがそれを見ると、彼女のクライアントは最初に`.content`をそのまま表示しますが、後で`.content`を解析し、`nostr:`URLがあることを確認します。そして、それをデコードし、公開鍵（および可能なリレーヒント）を抽出し、内部データベースまたはリレーからそのプロファイルを取得し、最後に完全なURLを名前`@mattn`に置き換え、そのプロファイルの内部ページビューへのリンクを付けます。

## 詳細で恐らく不必要な考慮事項

- 上記の例は非常に具体的ですが、すべてのクライアントが同じフローを実装する必要があるわけではありません。自動補完をまったくサポートしないクライアントもあり得ます。そのような場合、ユーザーがテキスト本文に生の[NIP-19](19.md)コードを貼り付けることを許可し、イベントを公開する前にこれらに`nostr:`を付けるだけです。
- 他のイベントを参照するフローも同様です：ユーザーが`note1...`または`nevent1...`コードを貼り付け、クライアントがそれを`nostr:note1...`または`nostr:nevent1...`URLに変換します。そして、そのような参照を読み取る際、クライアントは参照されたノートをプレビューボックスに表示したり、何も表示しなかったりします。
- 他の表示手順も採用できます：例えば、`kind:1`テキストノートのみを扱うように設計されたクライアントが、`.content`内に[`kind:30023`](23.md)の`nostr:naddr1...`URL参照を見つけた場合、そのようなイベントを表示できるハードコードされたWebアプリへのリンクに変換することを決定できます。
- クライアントは、言及されたイベントやプロファイルのタグを含めるかどうかをユーザーに選択させることができます。誰かが`mattn`に言及したいが通知はせず、ノート内にプロファイルへの素晴らしい拡張可能/クリック可能なリンクを持ちたい場合、その特定の言及に対して`["p", ...]`タグを作成しないようクライアントに指示できます。
- 同様に、誰かが別のノートを参照したいが、その参照が同じノートへの他の返信と一緒に表示されたくない場合、クライアントは`.content`内の任意の`nostr:nevent1...`URLに対応する`["e", ...]`タグを含めないことを選択できます。クライアントはこれらの高度な機能をユーザーに公開するか、より意見の強いものにするかを決定できます。